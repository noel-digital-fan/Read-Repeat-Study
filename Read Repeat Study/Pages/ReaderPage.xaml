<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Read_Repeat_Study.ReaderPage"
             BackgroundColor="White">

    <Grid RowSpacing="0" Padding="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Top Controls -->
        <Grid Grid.Row="0" ColumnSpacing="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <SearchBar x:Name="VoiceSearchBar" Placeholder="Search voices..."
                       TextChanged="OnVoiceSearchTextChanged" SearchButtonPressed="OnVoiceSearchButtonPressed" Grid.Column="0" />
            <Picker x:Name="VoicePicker" Title="Select Voice" SelectedIndexChanged="OnVoiceChanged" Focused="OnVoicePickerFocused" Grid.Column="1" />
            <Button x:Name="EditButton" Text="Edit" BackgroundColor="#03DAC5" TextColor="Black" FontSize="14" CornerRadius="6" HeightRequest="40" Clicked="OnEditDocumentClicked" Grid.Column="2" />
            <Button x:Name="SaveButton" Text="Save" BackgroundColor="#018786" TextColor="White" FontSize="14" CornerRadius="6" HeightRequest="40" IsVisible="False" Clicked="OnSaveDocumentClicked" Grid.Column="3" />
        </Grid>

        <!-- Reader Area -->
        <Frame Grid.Row="1" BorderColor="Gray" CornerRadius="8" HasShadow="False" BackgroundColor="White" Margin="0,12,0,12" VerticalOptions="Fill">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Scrollable phrases (read mode) -->
                <ScrollView x:Name="PhraseScrollView" Grid.Row="0" IsVisible="True" Padding="0">
                    <VerticalStackLayout x:Name="PhraseStack" Spacing="4" Padding="16,8,16,16" />
                </ScrollView>

                <!-- Single editor for edit mode -->
                <Editor x:Name="PageContentEditor" Grid.Row="0" Text="" FontSize="15" TextColor="Black" AutoSize="TextChanges" IsVisible="False" BackgroundColor="White" Margin="16,8,16,16" />

                <!-- Navigation -->
                <Grid Grid.Row="1" ColumnSpacing="10" Padding="10" BackgroundColor="#F5F5F5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Button x:Name="PreviousPageButton" Text="◀" WidthRequest="40" HeightRequest="35" FontSize="16" BackgroundColor="#6200EE" TextColor="White" CornerRadius="5" Clicked="OnPreviousPageClicked" Grid.Column="0" />
                    <Label x:Name="PageInfoLabel" Text="Page 1 of 1" FontSize="14" TextColor="Black" VerticalOptions="Center" HorizontalOptions="Center" Grid.Column="1" />
                    <Button x:Name="NextPageButton" Text="▶" WidthRequest="40" HeightRequest="35" FontSize="16" BackgroundColor="#6200EE" TextColor="White" CornerRadius="5" Clicked="OnNextPageClicked" Grid.Column="2" />
                </Grid>
            </Grid>
        </Frame>

        <!-- Playback Controls -->
        <HorizontalStackLayout Grid.Row="2" Spacing="20" HorizontalOptions="Center" Padding="0,12,0,12">
            <Button Text="Play" WidthRequest="80" HeightRequest="40" BackgroundColor="#6200EE" TextColor="White" CornerRadius="8" Clicked="OnPlayClicked" />
            <Button Text="Pause" WidthRequest="80" HeightRequest="40" BackgroundColor="#6200EE" TextColor="White" CornerRadius="8" Clicked="OnPauseClicked" />
            <Button x:Name="RepeatButton" Text="Repeat" WidthRequest="80" HeightRequest="40" BackgroundColor="#6200EE" TextColor="White" CornerRadius="8" Clicked="OnRepeatClicked" />
        </HorizontalStackLayout>
    </Grid>
</ContentPage>